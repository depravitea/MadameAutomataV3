import { SlashCommandBuilder } from 'discord.js'; import { prisma } from '../lib/db.js'; export const data=new SlashCommandBuilder().setName('consent').setDescription('Manage consent/limits').addSubcommand(s=>s.setName('set').setDescription('Set limits').addStringOption(o=>o.setName('limits').setDescription('Describe limits').setRequired(true))).addSubcommand(s=>s.setName('view').setDescription('View your limits')); export async function execute(i){ const sub=i.options.getSubcommand(); if(sub==='set'){ const limits=i.options.getString('limits',true); await prisma.consent.upsert({ where:{ id:`${i.guildId}-${i.user.id}` }, update:{ limits }, create:{ id:`${i.guildId}-${i.user.id}`, guildId:i.guildId!, userId:i.user.id, limits } }); await i.reply({ content:'Limits recorded. Your voice matters.',ephemeral:true}); } else { const c=await prisma.consent.findFirst({ where:{ guildId:i.guildId!, userId:i.user.id } }); await i.reply({ content:c?.limits || 'No limits on file.',ephemeral:true}); } }
